!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.MediumEditorInsert=e():t.MediumEditorInsert=e()}(this,function(){return function(t){function e(n){if(i[n])return i[n].exports;var o=i[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.get=void 0;var o=i(1),s=n(o);e.get=function(t){var e=t.Extension.extend({name:"insert",addons:{images:!0,embeds:!0},_initializedAddons:{},init:function(){t.Extension.prototype.init.apply(this,arguments),this.core=new s.default(this,t)},destroy:function(){this.core.removeButtons()},getCore:function(){return this.core},getAddons:function(){return this._initializedAddons},getAddon:function(t){return this._initializedAddons[t]}});return e}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(3),l=n(a),r=i(2),u=n(r),d=function(){function t(e,i){o(this,t),this._plugin=e,this._editor=this._plugin.base,this.MediumEditor=i,this.initAddons(),this.addButtons(),this.events()}return s(t,[{key:"getClosestWithClassName",value:function(t,e){return this.MediumEditor.util.traverseUp(t,function(t){return t.classList.contains(e)})}},{key:"isChildOf",value:function(t,e){return!!this.MediumEditor.util.traverseUp(t,function(t){return t===e})}},{key:"events",value:function(){var t=this,e=void 0;this._plugin.on(document,"click",this.toggleButtons.bind(this)),this._plugin.on(document,"keyup",this.toggleButtons.bind(this)),this._plugin.on(this.buttons.getElementsByClassName("medium-editor-insert-buttons-show")[0],"click",this.toggleAddons.bind(this)),e=this.buttons.getElementsByClassName("medium-editor-insert-action"),Array.prototype.forEach.call(e,function(e){t._plugin.on(e,"click",t.handleAddonClick.bind(t))}),this._plugin.on(window,"resize",this.positionButtons.bind(this))}},{key:"initAddons",value:function(){var t=this;this._plugin._initializedAddons={images:new l.default(this._plugin,this._plugin.addons.images,this.MediumEditor),embeds:new u.default(this._plugin,this._plugin.addons.embeds,this.MediumEditor)},Object.keys(this._plugin.addons).forEach(function(e){var i=t._plugin.addons[e];t._plugin._initializedAddons[e]||("function"==typeof i?t._plugin._initializedAddons[e]=new i(t._plugin):window.console.error("I don't know how to initialize custom \""+e+'" addon!')),i||delete t._plugin._initializedAddons[e]})}},{key:"addButtons",value:function(){var t=this._plugin.getAddons(),e=void 0;this.buttons=document.createElement("div"),this.buttons.id="medium-editor-insert-"+this._plugin.getEditorId(),this.buttons.classList.add("medium-editor-insert-buttons"),this.buttons.setAttribute("contentediable",!1),e='<a class="medium-editor-insert-buttons-show">+</a>\n    <ul class="medium-editor-insert-buttons-addons">',Object.keys(t).forEach(function(i){var n=t[i];e+='<li><a class="medium-editor-insert-action" data-addon="'+i+'">'+n.label+"</a></li>"}),e+="</ul>",this.buttons.innerHTML=e,document.body.appendChild(this.buttons)}},{key:"removeButtons",value:function(){this.buttons.remove()}},{key:"positionButtons",value:function(){var t=void 0,e=void 0,i=void 0,n=void 0,o=void 0,s=void 0,a=void 0;this.buttons.classList.contains("medium-editor-insert-buttons-active")!==!1&&(t=this._editor.getSelectedParentElement(),e=t.getBoundingClientRect(),i=this.buttons.getElementsByClassName("medium-editor-insert-buttons-addons")[0],n=this.buttons.getElementsByClassName("medium-editor-insert-action")[0],o=window.getComputedStyle(i),s=window.getComputedStyle(n),a={top:window.scrollY+e.top,left:window.scrollX+e.left-parseInt(o.left,10)-parseInt(s.marginLeft,10)},a.left=a.left<0?e.left:a.left,this.buttons.style.left=a.left+"px",this.buttons.style.top=a.top+"px")}},{key:"toggleButtons",value:function(){var t=this._editor.getSelectedParentElement();this.shouldDisplayButtonsOnElement(t)?(this.selectElement(t),this.showButtons()):(this.deselectElement(),this.hideButtons())}},{key:"shouldDisplayButtonsOnElement",value:function(t){var e=this,i=this._plugin.getAddons(),n=[],o=!1,s=!1;return""===t.innerText.trim()&&(this._plugin.getEditorElements().forEach(function(i){if(e.isChildOf(t,i))return void(s=!0)}),!!s&&(Object.keys(i).forEach(function(t){var e=i[t];e.elementClassName&&n.push(e.elementClassName)}),n.forEach(function(i){if(t.classList.contains(i)||e.getClosestWithClassName(t,i))return void(o=!0)}),!o))}},{key:"selectElement",value:function(t){this.selectedElement=t}},{key:"deselectElement",value:function(){this.selectedElement=null}},{key:"showButtons",value:function(){this.buttons.classList.add("medium-editor-insert-buttons-active"),this.positionButtons()}},{key:"hideButtons",value:function(){this.buttons.classList.remove("medium-editor-insert-buttons-active"),this.buttons.classList.remove("medium-editor-insert-addons-active")}},{key:"toggleAddons",value:function(){this.buttons.classList.toggle("medium-editor-insert-addons-active")}},{key:"handleAddonClick",value:function(t){var e=t.currentTarget.getAttribute("data-addon");t.preventDefault(),this._plugin.getAddon(e).handleClick(t)}}]),t}();e.default=d,t.exports=e.default},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=function(){function t(e,n,o){i(this,t),this.MediumEditor=o,this._plugin=e,this._editor=this._plugin.base,this.options={label:'<span class="fa fa-youtube-play"></span>'},Object.assign(this.options,n),this.label=this.options.label}return n(t,[{key:"handleClick",value:function(){window.console.log("embeds clicked")}}]),t}();e.default=o,t.exports=e.default},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=e.getToolbarButton=function(t){var e=t.extensions.button.extend({init:function(){this.button=this.document.createElement("button"),this.button.classList.add("medium-editor-action"),this.button.innerHTML="<b>"+this.label+"</b>",this.on(this.button,"click",this.handleClick.bind(this))},getButton:function(){return this.button},handleClick:function(){console.log(this.name+" clicked!")}});return e},l=e.getToolbar=function(t){var e=t.extensions.toolbar,l=function(e){function l(e){i(this,l);var o=n(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,e));return o.name=e.type+"Toolbar",e.buttons.forEach(function(e){var i=a(t),n=new i(Object.assign({},{window:o.plugin.window,document:o.plugin.document,base:o.plugin.base},e));n.init(),o.plugin.base.extensions.push(n)}),o.window=e.plugin.window,o.document=e.plugin.document,o.base=e.plugin.base,o.init(),o}return o(l,e),s(l,[{key:"getElementsByClassName",value:function(t,e){var i=[];return Array.prototype.forEach.call(t,function(t){var n=t.getElementsByClassName(e);Array.prototype.forEach.call(n,function(t){i.push(t)})}),i}},{key:"createToolbar",value:function(){var t=this.document.createElement("div");return t.id="medium-editor-insert-"+this.type+"-toolbar-"+this.getEditorId(),t.className="medium-editor-toolbar",this.static?t.className+=" static-toolbar":this.relativeContainer?t.className+=" medium-editor-relative-toolbar":t.className+=" medium-editor-stalker-toolbar",t.appendChild(this.createToolbarButtons()),this.forEachExtension(function(e){e.hasForm&&t.appendChild(e.getForm())}),this.attachEventHandlers(),t}},{key:"createToolbarButtons",value:function(){var e=this,i=this.document.createElement("ul"),n=void 0,o=void 0,s=void 0,a=void 0,l=void 0,r=void 0;return i.id="medium-editor-insert-"+this.type+"-toolbar-actions"+this.getEditorId(),i.className="medium-editor-toolbar-actions",i.style.display="block",this.buttons.forEach(function(s){"string"==typeof s?(l=s,r=null):(l=s.name,r=s),a=e.base.addBuiltInExtension(l,r),a&&"function"==typeof a.getButton&&(o=a.getButton(e.base),n=e.document.createElement("li"),t.util.isElement(o)?n.appendChild(o):n.innerHTML=o,i.appendChild(n))},this),s=i.querySelectorAll("button"),s.length>0&&(s[0].classList.add(this.firstButtonClass),s[s.length-1].classList.add(this.lastButtonClass)),i}},{key:"checkState",value:function(){var t=this,e=void 0;this.base.preventSelectionUpdates||setTimeout(function(){return e=t.getElementsByClassName(t.getEditorElements(),t.activeClassName),0===e.length?t.hideToolbar():void t.showAndUpdateToolbar()},10)}},{key:"setToolbarPosition",value:function(){var t=this.getElementsByClassName(this.getEditorElements(),this.activeClassName)[0],e=void 0;return t?(this.showToolbar(),this.positionStaticToolbar(t),e=this.base.getExtensionByName("anchor-preview"),void(e&&"function"==typeof e.hidePreview&&e.hidePreview())):this}}]),l}(e);return l},r=function(){function t(e,n,o){i(this,t),this.MediumEditor=o,this.options={label:'<span class="fa fa-camera"></span>',preview:!0,uploadUrl:"upload.php",deleteUrl:"delete.php",deleteMethod:"DELETE",deleteData:{}},Object.assign(this.options,n),this._plugin=e,this._editor=this._plugin.base,this.elementClassName="medium-editor-insert-images",this.activeClassName="medium-editor-insert-image-active",this.label=this.options.label,this.initToolbar(),this.events()}return s(t,[{key:"getElementsByClassName",value:function(t,e){var i=[];return Array.prototype.forEach.call(t,function(t){var n=t.getElementsByClassName(e);Array.prototype.forEach.call(n,function(t){i.push(t)})}),i}},{key:"generateRandomString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15;return Math.random().toString(36).substr(2,t)}},{key:"getClosestWithClassName",value:function(t,e){return this.MediumEditor.util.traverseUp(t,function(t){return t.classList.contains(e)})}},{key:"getElementsByTagName",value:function(t,e){var i=[];return Array.prototype.forEach.call(t,function(t){var n=t.getElementsByTagName(e);Array.prototype.forEach.call(n,function(t){i.push(t)})}),i}},{key:"events",value:function(){var t=this;this._plugin.on(document,"click",this.unselectImage.bind(this)),this._plugin.on(document,"keydown",this.removeImage.bind(this)),this._plugin.getEditorElements().forEach(function(e){t._plugin.on(e,"click",t.selectImage.bind(t))})}},{key:"handleClick",value:function(){this._input=document.createElement("input"),this._input.type="file",this._input.multiple=!0,this._plugin.on(this._input,"change",this.uploadFiles.bind(this)),this._input.click()}},{key:"initToolbar",value:function(){var t=l(this.MediumEditor);this.toolbar=new t({plugin:this._plugin,type:"images",activeClassName:this.activeClassName,buttons:[{name:"align-left",action:"left",label:"Left"},{name:"align-center",action:"center",label:"Center"},{name:"align-right",action:"right",label:"Right"}]}),this._editor.extensions.push(this.toolbar)}},{key:"uploadFiles",value:function(){var t=this,e=this._plugin.getCore().selectedElement;if("p"===e.nodeName.toLowerCase()){var i=document.createElement("div");e.parentNode.insertBefore(i,e),this._plugin.getCore().selectElement(i),e.remove()}Array.prototype.forEach.call(this._input.files,function(e){var i=t.generateRandomString();t.options.preview&&t.preview(e,i),t.upload(e,i)}),this._plugin.getCore().hideButtons()}},{key:"preview",value:function(t,e){var i=this,n=new FileReader;n.onload=function(t){i.insertImage(t.target.result,e)},n.readAsDataURL(t)}},{key:"upload",value:function(t,e){var i=this,n=new XMLHttpRequest,o=new FormData;n.open("POST",this.options.uploadUrl,!0),n.onreadystatechange=function(){if(4===n.readyState&&200===n.status){var t=i._plugin.getCore().selectedElement.querySelector('[data-uid="'+e+'"]');t?i.replaceImage(t,n.responseText):i.insertImage(n.responseText)}},o.append("file",t),n.send(o)}},{key:"insertImage",value:function(t,e){var i=this._plugin.getCore().selectedElement,n=document.createElement("figure"),o=document.createElement("img"),s=void 0;return o.alt="",e&&o.setAttribute("data-uid",e),t.match(/^data:/)?(o.src=t,n.appendChild(o),i.appendChild(n)):(s=new Image,s.onload=function(){o.src=s.src,n.appendChild(o),i.appendChild(n)},s.src=t),i.classList.add(this.elementClassName),s}},{key:"replaceImage",value:function(t,e){var i=new Image;return i.onload=function(){t.src=i.src,t.removeAttribute("data-uid")},i.src=e,i}},{key:"selectImage",value:function(t){var e=t.target;"img"===e.nodeName.toLowerCase()&&this.getClosestWithClassName(e,this.elementClassName)&&(e.classList.add(this.activeClassName),this._editor.selectElement(e))}},{key:"unselectImage",value:function(t){var e=this,i=t.target,n=void 0,o=void 0;"img"===i.nodeName.toLowerCase()&&i.classList.contains(this.activeClassName)&&(n=i),o=this.getElementsByClassName(this._plugin.getEditorElements(),this.activeClassName),Array.prototype.forEach.call(o,function(t){t!==n&&t.classList.remove(e.activeClassName)})}},{key:"removeImage",value:function(t){var e=this;if([this.MediumEditor.util.keyCode.BACKSPACE,this.MediumEditor.util.keyCode.DELETE].indexOf(t.which)>-1){var i=this.getElementsByClassName(this._plugin.getEditorElements(),this.activeClassName),n=window.getSelection(),o=void 0;if(n&&n.rangeCount){var s=this.MediumEditor.selection.getSelectionRange(document),a=this.MediumEditor.selection.getSelectedParentElement(s),l=this.MediumEditor.selection.getCaretOffsets(a).left,r=void 0;if(t.which===this.MediumEditor.util.keyCode.BACKSPACE&&0===l?r=a.previousElementSibling:t.which===this.MediumEditor.util.keyCode.DELETE&&l===a.innerText.length&&(r=a.nextElementSibling),r&&r.classList.contains("medium-editor-insert-images")){var u=r.getElementsByTagName("img");Array.prototype.forEach.call(u,function(t){i.push(t)})}if(o=this.MediumEditor.selection.getSelectionHtml(document)){var d=document.createElement("div"),c=void 0,h=void 0;d.innerHTML=o,c=d.getElementsByClassName("medium-editor-insert-images"),h=this.getElementsByTagName(c,"img"),Array.prototype.forEach.call(h,function(t){i.push(t)})}}i.length&&(o||t.preventDefault(),i.forEach(function(i){var n=e.getClosestWithClassName(i,"medium-editor-insert-images");if(e.deleteFile(i.src),i.parentNode.remove(),0===n.childElementCount){var s=n.nextElementSibling,a=n.previousElementSibling;n.remove(),o||(s||a)&&(s&&t.which===e.MediumEditor.util.keyCode.DELETE||!a?e.MediumEditor.selection.moveCursor(document,s,0):e.MediumEditor.selection.moveCursor(document,a.lastChild,a.lastChild.textContent.length))}}))}}},{key:"deleteFile",value:function(t){if(this.options.deleteUrl){var e=new XMLHttpRequest,i=Object.assign({},{file:t},this.options.deleteData);e.open(this.options.deleteMethod,this.options.deleteUrl,!0),e.send(i)}}}]),t}();e.default=r}])});
//# sourceMappingURL=medium-editor-insert.min.js.map